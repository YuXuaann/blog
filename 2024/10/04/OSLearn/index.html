
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8" />
    <title>OS学习随笔 | YuXuaan&#39;s Blog</title>
    <meta name="author" content="YuXuaan" />
    <meta name="description" content="Be a mortal." />
    <meta name="keywords" content="" />
    <meta
        name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"
    />
    <link rel="icon" href="/images/avatar.png" />
    <link rel="preconnect" href="https://s4.zstatic.net" />
<script src="https://s4.zstatic.net/ajax/libs/vue/3.3.7/vue.global.prod.min.js"></script>
<link rel="stylesheet" href="https://s4.zstatic.net/ajax/libs/font-awesome/6.4.2/css/all.min.css" />
<link rel="preconnect" href="https://fonts.googleapis.cn" />
<link rel="preconnect" href="https://fonts.gstatic.cn" crossorigin />
<link
    rel="stylesheet"
    href="https://fonts.googleapis.cn/css2?family=Fira+Code:wght@400;500;600;700&family=Lexend:wght@400;500;600;700;800;900&family=Noto+Sans+SC:wght@400;500;600;700;800;900&display=swap"
/>
<script> const mixins = {}; </script>

<script src="https://polyfill.alicdn.com/v3/polyfill.min.js?features=default"></script>


<script src="https://s4.zstatic.net/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
<script src="https://s4.zstatic.net/ajax/libs/highlightjs-line-numbers.js/2.8.0/highlightjs-line-numbers.min.js"></script>
<link
    rel="stylesheet"
    href="https://s4.zstatic.net/ajax/libs/highlight.js/11.9.0/styles/github.min.css"
/>
<script src="/js/lib/highlight.js"></script>


<script src="https://s4.zstatic.net/ajax/libs/KaTeX/0.16.9/katex.min.js"></script>
<script src="https://s4.zstatic.net/ajax/libs/KaTeX/0.16.9/contrib/auto-render.min.js"></script>
<link rel="stylesheet" href="https://s4.zstatic.net/ajax/libs/KaTeX/0.16.9/katex.min.css" />
<script src="/js/lib/math.js"></script>


<script src="/js/lib/preview.js"></script>









<link rel="stylesheet" href="/css/main.css" />

<!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.3.0"></head>
<body>
    <div id="layout">
        <transition name="fade">
            <div id="loading" v-show="loading">
                <div id="loading-circle">
                    <h2>LOADING</h2>
                    <p>加载过慢请开启缓存 浏览器默认开启</p>
                    <img src="/images/loading.gif" />
                </div>
            </div>
        </transition>
        <div id="menu" :class="{ hidden: hiddenMenu, 'menu-color': menuColor}">
    <nav id="desktop-menu">
        <a class="title" href="/">
            <span>YUXUAAN&#39;S BLOG</span>
        </a>
        
        <a href="/">
            <i class="fa-solid fa-house fa-fw"></i>
            <span>&ensp;Home</span>
        </a>
        
        <a href="/about">
            <i class="fa-solid fa-id-card fa-fw"></i>
            <span>&ensp;About</span>
        </a>
        
        <a href="/archives">
            <i class="fa-solid fa-box-archive fa-fw"></i>
            <span>&ensp;Archives</span>
        </a>
        
        <a href="/categories">
            <i class="fa-solid fa-bookmark fa-fw"></i>
            <span>&ensp;Categories</span>
        </a>
        
        <a href="/tags">
            <i class="fa-solid fa-tags fa-fw"></i>
            <span>&ensp;Tags</span>
        </a>
        
    </nav>
    <nav id="mobile-menu">
        <div class="title" @click="showMenuItems = !showMenuItems">
            <i class="fa-solid fa-bars fa-fw"></i>
            <span>&emsp;YUXUAAN&#39;S BLOG</span>
        </div>
        <transition name="slide">
            <div class="items" v-show="showMenuItems">
                
                <a href="/">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-house fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">Home</div>
                    </div>
                </a>
                
                <a href="/about">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-id-card fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">About</div>
                    </div>
                </a>
                
                <a href="/archives">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-box-archive fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">Archives</div>
                    </div>
                </a>
                
                <a href="/categories">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-bookmark fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">Categories</div>
                    </div>
                </a>
                
                <a href="/tags">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-tags fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">Tags</div>
                    </div>
                </a>
                
            </div>
        </transition>
    </nav>
</div>
<transition name="fade">
    <div id="menu-curtain" @click="showMenuItems = !showMenuItems" v-show="showMenuItems"></div>
</transition>

        <div id="main" :class="loading ? 'into-enter-from': 'into-enter-active'">
            <div class="article">
    <div>
        <h1>OS学习随笔</h1>
    </div>
    <div class="info">
        <span class="date">
            <span class="icon">
                <i class="fa-solid fa-calendar fa-fw"></i>
            </span>
            2024/10/4
        </span>
        
        <span class="category">
            <a href="/categories/learn/">
                <span class="icon">
                    <i class="fa-solid fa-bookmark fa-fw"></i>
                </span>
                learn
            </a>
        </span>
        
        
        <span class="tags">
            <span class="icon">
                <i class="fa-solid fa-tags fa-fw"></i>
            </span>
            
            
            <span class="tag">
                
                <a href="/tags/OS/" style="color: #00a596">
                    OS
                </a>
            </span>
            
        </span>
        
    </div>
    
    <div class="content" v-pre>
        <p>OS是建立在上层软件和下层硬件之间的重要桥梁.</p>
<span id="more"></span>

<p>源自<a target="_blank" rel="noopener" href="https://rcore-os.cn/rCore-Tutorial-Book-v3/">rCore-Tutorial-Book</a></p>
<h2 id="RISC-V-寄存器编号和别名"><a href="#RISC-V-寄存器编号和别名" class="headerlink" title="RISC-V 寄存器编号和别名"></a>RISC-V 寄存器编号和别名</h2><table>
<thead>
<tr>
<th align="center">寄存器</th>
<th align="center">别名</th>
<th align="center">全称</th>
<th align="center">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="center">$x_0$</td>
<td align="center">$zero$</td>
<td align="center">零寄存器</td>
<td align="center">写无效</td>
</tr>
<tr>
<td align="center">$x_1$</td>
<td align="center"><strong>$ra$</strong></td>
<td align="center">链接寄存器</td>
<td align="center">函数返回地址</td>
</tr>
<tr>
<td align="center">$x_2$</td>
<td align="center"><strong>$sp$</strong></td>
<td align="center">栈指针寄存器</td>
<td align="center">指向下一个将要被存储的栈顶位置</td>
</tr>
<tr>
<td align="center">$x_3$</td>
<td align="center">$gp$</td>
<td align="center">全局指针寄存器</td>
<td align="center">全局变量指针（基地址）</td>
</tr>
<tr>
<td align="center">$x_4$</td>
<td align="center">$tp$</td>
<td align="center">线程指针寄存器</td>
<td align="center">线程指针（基地址）</td>
</tr>
<tr>
<td align="center">$x_5$~$x_7$</td>
<td align="center">$t_0$~$t_2$</td>
<td align="center">临时寄存器</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">$x_8$</td>
<td align="center">$s_0$&#x2F;$fp$</td>
<td align="center">帧指针寄存器</td>
<td align="center">临时寄存器&#x2F;指向当前函数调用的栈帧的基地址</td>
</tr>
<tr>
<td align="center">$x_9$</td>
<td align="center">$s_1$</td>
<td align="center"></td>
<td align="center">用于函数调用，被调用函数需要保存的数据</td>
</tr>
<tr>
<td align="center">$x_{10}$~$x_{17}$</td>
<td align="center">$a_0$~$a_7$</td>
<td align="center"></td>
<td align="center">用于函数调用，传递参数和返回值</td>
</tr>
<tr>
<td align="center">$x_{18}$~$x_{27}$</td>
<td align="center">$s_2$~$s_{11}$</td>
<td align="center"></td>
<td align="center">用于函数调用，被调用函数需要保存的数据</td>
</tr>
<tr>
<td align="center">$x_{28}$~$x_{31}$</td>
<td align="center">$t_3$~$t_6$</td>
<td align="center"></td>
<td align="center">临时寄存器</td>
</tr>
</tbody></table>
</br>
</br>

<table>
<thead>
<tr>
<th align="center">CSR 寄存器</th>
<th align="center">全称</th>
<th align="center">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="center">mstatus</td>
<td align="center"></td>
<td align="center">存储全局的机器状态信息</td>
</tr>
<tr>
<td align="center">mepc</td>
<td align="center"></td>
<td align="center">存储发生异常时的程序计数器值</td>
</tr>
<tr>
<td align="center">mcause</td>
<td align="center"></td>
<td align="center">存储导致异常的原因</td>
</tr>
<tr>
<td align="center">mtval</td>
<td align="center">Machine Trap Value</td>
<td align="center">存储与异常相关的附加信息</td>
</tr>
<tr>
<td align="center">mscratch</td>
<td align="center">Scratch</td>
<td align="center">用于异常处理程序的临时存储</td>
</tr>
<tr>
<td align="center">mie</td>
<td align="center"></td>
<td align="center">控制各类中断的使能</td>
</tr>
<tr>
<td align="center">mip</td>
<td align="center"></td>
<td align="center">指示各类中断的挂起状态</td>
</tr>
<tr>
<td align="center">sstatus</td>
<td align="center"></td>
<td align="center">存储全局的监督者模式状态信息</td>
</tr>
<tr>
<td align="center">sepc</td>
<td align="center">Exception PC</td>
<td align="center">存储发生异常时的程序计数器值</td>
</tr>
<tr>
<td align="center">scause</td>
<td align="center"></td>
<td align="center">存储导致陷阱的原因</td>
</tr>
<tr>
<td align="center">stval</td>
<td align="center"></td>
<td align="center">存储与陷阱相关的附加信息</td>
</tr>
<tr>
<td align="center">stvec</td>
<td align="center"></td>
<td align="center">存储异常处理程序的入口地址</td>
</tr>
<tr>
<td align="center">sscratch</td>
<td align="center"></td>
<td align="center">用于监督者模式异常处理程序的临时存储</td>
</tr>
<tr>
<td align="center">sie</td>
<td align="center"></td>
<td align="center">控制监督者模式下各类中断的使能</td>
</tr>
<tr>
<td align="center">sip</td>
<td align="center"></td>
<td align="center">指示监督者模式下各类中断的挂起状态</td>
</tr>
</tbody></table>
<h2 id="操作系统基本知识"><a href="#操作系统基本知识" class="headerlink" title="操作系统基本知识"></a>操作系统基本知识</h2><h3 id="系统软件"><a href="#系统软件" class="headerlink" title="系统软件"></a>系统软件</h3><ol>
<li>定义：为计算机系统提供基本功能，并在计算机系统范围内使用的软件，其作用可涉及到整个计算机系统。</li>
<li>包括：<strong>操作系统内核</strong>、驱动程序、工具软件、用户界面、软件库等</li>
<li>操作系统内核是负责控制计算机的硬件资源并为用户和应用程序提供服务，操作系统也算是一种系统软件</li>
</ol>
<h3 id="执行环境"><a href="#执行环境" class="headerlink" title="执行环境"></a>执行环境</h3><p><img src="/2024/10/04/OSLearn/exe_env.png" alt="alt text"></p>
<ol>
<li>操作系统的定义可以被简化为: <strong>应用程序的软件执行环境</strong></li>
</ol>
<h3 id="操作系统"><a href="#操作系统" class="headerlink" title="操作系统"></a>操作系统</h3><ol>
<li>真定义：操作系统是一种系统软件，主要功能是向下管理CPU、内存和各种外设等硬件资源，并形成软件执行环境来向上管理和服务应用软件；操作系统对计算机硬件重要组成的抽象和虚拟化，有助于应用程序开发</li>
<li>主要组成：内核、系统工具和软件库、用户接口</li>
<li>API: 应用程序接口，是操作系统提供给应用程序的接口，是不同二进制代码片段的纽带</li>
<li>ABI: 定义了二进制机器代码级别的规则，例如寄存器怎么用，是用来约束链接器 (Linker) 和汇编器 (Assembler) 的；操作系统主要通过基于 ABI 的系统调用接口来给应用程序提供上述服务</li>
</ol>
<h3 id="控制流上下文"><a href="#控制流上下文" class="headerlink" title="控制流上下文"></a>控制流上下文</h3><ol>
<li>定义：确保下一时刻能继续 正确 执行控制流指令的物理资源内容</li>
<li>异常控制流<ol>
<li>中断：外设引起的I&#x2F;O操作，与<strong>CPU无关</strong></li>
<li>异常：CPU执行过程中发现的</li>
<li>陷入( <code>trap</code> )：操作系统需要执行系统调用服务</li>
</ol>
</li>
</ol>
<h3 id="进程"><a href="#进程" class="headerlink" title="进程"></a>进程</h3><ol>
<li>定义：一个正在运行的程序实例，它自己认为拥有整个地址空间，占有整个CPU；精确定义：一个进程是一个具有一定独立功能的程序在一个数据集合上的一次动态执行过程</li>
</ol>
<h3 id="地址空间"><a href="#地址空间" class="headerlink" title="地址空间"></a>地址空间</h3><ol>
<li>定义：是对物理内存的虚拟化和抽象，也称虚存 (Virtual Memory)</li>
</ol>
<h3 id="文件"><a href="#文件" class="headerlink" title="文件"></a>文件</h3><ol>
<li>文件 (File) 主要用于对持久存储的抽象，并进一步扩展到为外设的抽象</li>
</ol>
<h3 id="任务"><a href="#任务" class="headerlink" title="任务"></a>任务</h3><ol>
<li>任务 (Task) : 应用程序的一次执行过程(也是一段控制流)，应用程序在一个时间片段内的执行过程称为任务片</li>
<li>任务切换：两个不同应用在内核中 <code>trap</code> 流的切换</li>
<li>任务上下文：在任务切换的 <code>trap</code> 流中所需要保存的上下文</li>
</ol>
<h2 id="Qemu-启动流程"><a href="#Qemu-启动流程" class="headerlink" title="Qemu 启动流程"></a>Qemu 启动流程</h2><ol>
<li>Qemu CPU 的起始 PC 地址为<code>0x1000</code>，在 Qemu 中内嵌了几条指令，用于初始化 CPU，然后跳转到<code>0x80000000</code>处执行</li>
<li>物理内存的起始物理地址为<code>0x80000000</code>，这一阶段需要进行各个设备的初始化，所以在这里交由 Bootloader 来完成，完成后跳转到 Kernel 的入口地址</li>
<li>在 RustSBI 的 Bootloader 中，会将 Kernel 加载到<code>0x80200000</code>处，所以我们需要把内核镜像加载到这个地址</li>
</ol>
<h2 id="gdb调试常用命令"><a href="#gdb调试常用命令" class="headerlink" title="gdb调试常用命令"></a>gdb调试常用命令</h2><ol>
<li><code>b</code>：设置断点</li>
<li><code>r</code>：运行程序</li>
<li><code>c</code>：继续运行</li>
<li><code>n</code>：单步执行</li>
<li><code>s</code>：单步执行，如果遇到函数调用则进入函数</li>
<li><code>p</code>：打印变量的值</li>
<li><code>bt</code>：查看函数调用栈</li>
<li><code>q</code>：退出gdb</li>
<li><code>p/d $x1</code>：查看<code>x1</code>寄存器的值</li>
<li><code>x/10i $pc</code>：查看当前指令附近的10条指令</li>
</ol>
<h2 id="内存布局"><a href="#内存布局" class="headerlink" title="内存布局"></a>内存布局</h2><p><img src="/2024/10/04/OSLearn/mem.png" alt="内存布局"></p>
<ol>
<li>数据部分<ul>
<li>未初始化数据段(<code>.bss</code>)，存放未初始化的全局数据，通常由程序的加载者代为进行零初始化，即将这块区域逐字节清零</li>
<li>初始化数据段(<code>.rodata</code>、<code>.data</code>)，前者存放只读的全局数据，通常是一些常量；而后者存放可修改的全局数据</li>
<li>堆：存放程序动态分配的内存，例如<code>malloc</code>函数</li>
<li>栈：存放函数的局部变量、函数参数、返回地址等，栈是向下增长的</li>
</ul>
</li>
<li>代码部分<ul>
<li>代码段(<code>.text</code>)：存放程序的机器指令，通常是只读的</li>
</ul>
</li>
</ol>
<h2 id="编译流程"><a href="#编译流程" class="headerlink" title="编译流程"></a>编译流程</h2><ol>
<li>编译：高级语言编译器将源代码编译成汇编代码</li>
<li>汇编：汇编器将汇编代码转换成机器码</li>
<li>链接：链接器将机器码和库文件链接成可执行文件，将各段放置在内存的合适位置</li>
</ol>
<h2 id="函数调用"><a href="#函数调用" class="headerlink" title="函数调用"></a>函数调用</h2><p><img src="/2024/10/04/OSLearn/call_func.png" alt="函数调用"></p>
<ol>
<li>函数调用上下文 (Function Call Context)：由于函数调用，在控制流转移前后需要保持不变的寄存器集合</li>
<li>CALL 函数时，上下文将保存在内存里；从函数 Return 时，上下文将恢复到寄存器中</li>
<li>调用者和被调用者合作保存寄存器<ul>
<li>调用者保存不希望在函数调用中发生变化的寄存器，在函数调用返回后调用子函数恢复($a_0 ~ a_7$、$t_0 ~ t_6$)</li>
<li>被调用者在函数起始保存执行过程中会发生变化的寄存器，在函数退出之前恢复($s_0 ~ s_{11}$、 $r_a$、 $s_p$、 $f_p$)</li>
<li><img src="/2024/10/04/OSLearn/fp_sp.png" alt="fp和sp"></li>
</ul>
</li>
</ol>
<h2 id="特权等级"><a href="#特权等级" class="headerlink" title="特权等级"></a>特权等级</h2><p><img src="/2024/10/04/OSLearn/exe_env_stack.png" alt="执行环境栈"></p>
<ol>
<li><p><code>ecall</code> 具有用户态到内核态的执行环境切换能力的函数调用指令；</p>
<p><img src="/2024/10/04/OSLearn/ecall.png" alt="ecall"></p>
</li>
<li><p><code>sret</code> ：具有内核态到用户态的执行环境切换能力的函数返回指令。</p>
</li>
<li><p>监控管理：当上层软件执行的时候出现了一些异常或特殊情况，导致需要用到执行环境中提供的功能，因此需要暂停上层软件的执行，转而运行执行环境的代码</p>
</li>
<li><p>断点&#x2F;执行环境调用：陷入类指令或trap类指令</p>
</li>
<li><p>低特权级软件的要求超出了其能力范围，就必须寻求高特权级软件的帮助，否则就是一种异常行为了</p>
</li>
<li><p>低特权级的软件的某条指令发生了某种错误(除零、无效地址访问、无效指令、执行高特权级指令等)，触发异常，交由高特权级软件(如os)处理，由它判断恢复&#x2F;杀死</p>
</li>
</ol>
<h2 id="ch2-邓氏鱼操作系统"><a href="#ch2-邓氏鱼操作系统" class="headerlink" title="ch2 邓氏鱼操作系统"></a>ch2 邓氏鱼操作系统</h2><table>
<thead>
<tr>
<th align="center">功能</th>
<th align="center">进度</th>
<th align="center">备注</th>
</tr>
</thead>
<tbody><tr>
<td align="center">批处理系统</td>
<td align="center">✔️</td>
<td align="center">用来自动安排程序的执行</td>
</tr>
<tr>
<td align="center">系统调用服务</td>
<td align="center">✔️</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">多道程序</td>
<td align="center">✖️</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">分时多任务</td>
<td align="center">✖️</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">动态分配内存</td>
<td align="center">✖️</td>
<td align="center"></td>
</tr>
</tbody></table>
<ol>
<li><p>它对于用户程序调用系统函数的实现</p>
<pre><code class="text">//!                     存储trap上下文                                恢复trap上下文
//! 用户程序 -&gt; ecall -&gt; __alltraps -&gt; trap_handler(UserEnvCall) -&gt; __restore(含sret) -&gt; 用户程序
//!    U     -&gt;   S  -&gt;      S      -&gt;             S             -&gt;         S         -&gt;    U
</code></pre>
</li>
<li><p>它对于执行应用程序的实现</p>
<ol>
<li>构造启动应用程序所需 <code>trap</code> 上下文，具体包含：全部为0的寄存器、sp寄存器设定为用户栈指针、特权态为用户态、return_addr设定为应用起始地址</li>
<li>压入内核栈，并返回栈指针</li>
<li>调用 <code>_restore</code> 进U态执行用户程序</li>
</ol>
</li>
</ol>
<h2 id="ch3-始初龙操作系统、腔骨龙操作系统"><a href="#ch3-始初龙操作系统、腔骨龙操作系统" class="headerlink" title="ch3 始初龙操作系统、腔骨龙操作系统"></a>ch3 始初龙操作系统、腔骨龙操作系统</h2><table>
<thead>
<tr>
<th align="center">功能</th>
<th align="center">进度</th>
<th align="center">备注</th>
</tr>
</thead>
<tbody><tr>
<td align="center">批处理系统</td>
<td align="center">✔️</td>
<td align="center">处理器只能一次运行一个程序，运行完毕才能运行下一个</td>
</tr>
<tr>
<td align="center">系统调用服务</td>
<td align="center">✔️</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">多道程序</td>
<td align="center">✔️</td>
<td align="center">处理器可以交错执行多个程序，程序可以主动或被动放弃执行</td>
</tr>
<tr>
<td align="center">分时多任务</td>
<td align="center">✔️</td>
<td align="center">操作系统管理每个应用程序，以<strong>时间片</strong>为单位来分时占用处理器</td>
</tr>
<tr>
<td align="center">动态分配内存</td>
<td align="center">✖️</td>
<td align="center"></td>
</tr>
</tbody></table>
<ol>
<li><p>在内存中同一时间可以驻留多个应用，而且所有的应用都是在系统启动的时候分别加载到内存的不同区域中</p>
</li>
<li><p>同一时间最多只有一个应用在执行（目前是单核），但是应用可以发出 <code>yield</code> 请求主动放弃占用处理器</p>
</li>
<li><p>它对于执行应用程序(任务)的实现</p>
<pre><code class="text">//!                                存储trap上下文                                                      恢复trap上下文
//! 用户程序 -&gt; ecall(sys_yield) -&gt; __alltraps -&gt; trap_handler(UserEnvCall) -&gt; __switch(cur,next) -&gt; __restore(含sret) -&gt; 用户程序
//!    U     -&gt;   S              -&gt;      S     -&gt;             S             -&gt;         S          -&gt;         S         -&gt;    U
</code></pre>
<ol>
<li>构造启动应用程序所需 <code>trap</code> 上下文，压入所有程序的内核栈；并且构造所有应用程序的初始任务上下文，设置 <code>ra = __restore</code> ，若是执行第一个任务，则构造一个空任务上下文与之 <code>__switch</code> ; 若非第一个任务，则 <code>__switch(current_task_cx, next_task_cx)</code></li>
<li><code>switch</code> 结束后，返回到 <code>_restore</code> 进U态执行用户程序</li>
</ol>
</li>
<li><p>分时多任务：把用户态下应用程序主动发出的 <code>yield</code> 请求改成时钟中断即可，两者的本质 <code>__switch</code>  是一样的</p>
</li>
</ol>
<h2 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h2><ol>
<li>batch一般指批处理，而job一般指作业</li>
<li>fd 通常是文件描述符（File Descriptor）的缩写</li>
</ol>

    </div>
    
    
    
    
    
    
    
</div>

            <footer id="footer">
    <div id="footer-wrap">
        <div>
            &copy;
            2022 - 2024 YuXuaan&#39;s Blog
            <span id="footer-icon">
                <i class="fa-solid fa-font-awesome fa-fw"></i>
            </span>
            &commat;YuXuaan
        </div>
        <div>
            Based on the <a target="_blank" rel="noopener" href="https://hexo.io">Hexo Engine</a> &amp;
            <a target="_blank" rel="noopener" href="https://github.com/theme-particlex/hexo-theme-particlex">ParticleX Theme</a>
        </div>
        
    </div>
</footer>

        </div>
        
        <transition name="fade">
            <div id="preview" ref="preview" v-show="previewShow">
                <img id="preview-content" ref="previewContent" />
            </div>
        </transition>
        
    </div>
    <script src="/js/main.js"></script>
    
    




    
</body>
</html>
